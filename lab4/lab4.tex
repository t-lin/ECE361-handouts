\documentclass[11pt]{article}

\usepackage{../style/ece361}

%-------------------------------------------------------------------------------------------------

% Lab parameters
\def\thelab{4}
\def\datedue{Mar. 24, 2020 @ 11:59 PM}

\useCompactTitle{ECE361 Lab \thelab}{Medium Access Control (MAC)}

%-------------------------------------------------------------------------------------------------
\begin{document}
% Create title page, and force header and footer onto it
\maketitle \thispagestyle{fancy}

\hfill {\large \textbf{Due \datedue}}
%-------------------------------------------------------------------------------------------------


%-------------------------------------------------------------------------------------------------
\section{Overview}
\label{sec:overview}
%-------------------------------------------------------------------------------------------------
One of the fundamental design challenges in networking is the issue of sharing access to a single communication medium.
This challenge is apparent in wireless networks, but also exists in wired networks, as you will see in the second half of this lab.
Medium Access Control (MAC) protocols enable multiple stations to share access to a single medium; and the choice of protocol (and its various parameters) directly affects the efficiency of the channel utilization.

In this lab you will simulate two alternative Medium Access Control (MAC) protocols and explore their properties.
In the first part, you will be given a working simulator for the ALOHA MAC protocol ("Pure ALOHA") to explore, which you must modify to implement Slotted ALOHA.
In the second part of the lab, you will implement the core logic of a Carrier Sense Multiple Access with Collision Detection (CSMA/CD) simulator.

%-------------------------------------------------------------------------------------------------
\section{Lab Initialization}
\label{subsec:lab-init}
%-------------------------------------------------------------------------------------------------
This lab includes starter code that uses a custom-built Python 3 library called \texttt{ece361}.
A Python virtual environment will be created, that will include the library, where you will do all the work in this lab.
We have provided an initialization script for you that will setup this virtual environment, along with the starter code, and the custom library.

\hint{It's highly recommended to update your VM before starting each lab. Open a terminal (in the VM), and type \texttt{ece361-update}}

To run the initialization script for lab \thelab, open a terminal and type \texttt{ece361-lab-init \thelab}.
You should see something similar to Listing~\ref{lst:init-example}.

\begin{lstlisting}[style=ece361shell, caption={Initializing lab \thelab.}, label={lst:init-example}]
ubuntu@ece361:~$ ece361-lab-init (@"\thelab"@)
Finding available UG EECG host...
Warning: Permanently added 'ug251.eecg.utoronto.ca,128.100.13.251' (ECDSA) to the list of known hosts.
Creating working directory for lab (@"\thelab"@) at (@"\btHL /home/ubuntu/lab\thelab"@)
Creating Python3 virtual environment...
Installing libraries...

...

Done. Now run (@"\btHL source /home/ubuntu/lab\thelab/sourceMe"@) to activate the virtual environment.
\end{lstlisting}

The initialization script creates a working directory for this lab, located at \texttt{\textasciitilde/lab\thelab}.
To activate the virtual environment, run the source command as shown in Listing \ref{lst:init-example}.
Once the virtual environment is activated, you should see a \texttt{(.venv)} appear at the beginning of your prompt.

\point{You will need to activate the virtual environment \textbf{in each terminal} that runs code belonging to this lab.}

\warn{The \texttt{ece361} library used in this lab is different than the ones from the previous three labs. Your code from the previous labs will not work in this new virtual environment.}

In your lab \thelab~working directory, you should have the following files:
\begin{itemize}
	\item \texttt{\textbf{TODO FILE}}
        \begin{itemize}
            \item \textbf{TO DO DESCRIPTION}
        \end{itemize}
\end{itemize}

\point{If you discover a bug in any of the files provided, please report it on Piazza.}


%-------------------------------------------------------------------------------------------------
\section{Part 1: Slotted ALOHA}
\label{sec:sotted-aloha}
%-------------------------------------------------------------------------------------------------
In this part, you will begin by taking an ALOHA simulator (given to you) and extending it to become Slotted ALOHA.
In Slotted ALOHA, stations are synchronized to transmit frames only at the start of a slot interval, and thus, it is simply a discretized version of ALOHA.

The provided simulator takes a single command-line parameter, \texttt{G}, and runs the simulation based on that parameter.
Run the simulator by simply calling it with a parameter for G, as shown in Listing~\ref{lst:start-sim}.

\begin{lstlisting}[style=ece361shell, caption={Running the Slotted ALOHA simulator (default behaviour is ALOHA)}, label={lst:start-sim}]
(.venv) ubuntu@361:~/lab4$ python3 slotted_aloha.py
USAGE: python3 slotted_aloha.py <total arrival rate G>
(.venv) ubuntu@361:~/lab4$
(.venv) ubuntu@361:~/lab4$ python3 slotted_aloha.py 0.5
2020-03-08 22:28:41,829 slotted_aloha INFO: Frame size = 704 bits
2020-03-08 22:28:41,829 slotted_aloha INFO: Tx Rate = 96000 bps
2020-03-08 22:28:41,830 slotted_aloha INFO: Serializaiton delay = 0.007333333333333333 seconds
2020-03-08 22:28:41,830 slotted_aloha INFO: Propagation delay = 0 seconds
2020-03-08 22:28:41,830 slotted_aloha INFO: Global arrival rate = 68.18181818181819 frames / second
2020-03-08 22:28:41,830 slotted_aloha INFO: Number of stations = 3
2020-03-08 22:28:41,830 slotted_aloha INFO: Per-station arrival rate = 22.72727272727273 frames / second
2020-03-08 22:28:41,831 slotted_aloha INFO: ====================

...

\end{lstlisting}


The result of the simulation will be appended to a file called \texttt{out.txt} (one will be created if it doesn't already exist), where each line is a comma-delimited entry showing \texttt{G} and \texttt{S}, respectively.
When you run the simulation multiple times over, with varying values of \texttt{G}, you can populate the output file with a series of data points, as seen in Listing~\ref{lst:aloha-output}.

\begin{lstlisting}[style=ece361shell, caption={Sample data from \texttt{out.txt} for ALOHA}, label={lst:aloha-output}]
0.03125,0.029624704097476643
0.0625,0.057893199350203525
0.125,0.10240504689659247
0.25,0.15737031469013515
0.5,0.19284254160579692
1.0,0.1651676868095355
2.0,0.04724612507409784
\end{lstlisting}

You can use this data to then graph the \texttt{G} vs \texttt{S} curves you have seen from lecture (e.g. see Fig.~\ref{pure-aloha}).
There are other parameters within the simulation code as well, but for the purposes of the lab, we have hard-coded them for you.
\warn{Do NOT modify the hard-coded parameters, it may affect the simulator's ability to produce accurate results.}
\figvs{0.6}{pure-aloha}{trim=0cm 0cm 0cm 0cm,clip}{Sample graph of ALOHA based on simulator's output.}

The code given to you has already calculated the slot interval.
Study the code carefully, particularly when the stations decide to transmit a frame.

\work{Your task is to discretize the simulator by syncing the frame transmissions to the start of each interval.}

After you have made your modifications, generate a new \texttt{G} vs \texttt{S} curve and see if it matches the theoretical improvement of Slotted ALOHA over ALOHA (see Fig.~\ref{pure-vs-slotted}).

\figvs{0.6}{pure-vs-slotted}{trim=0cm 0cm 0cm 0cm,clip}{Sample graph of Pure ALOHA vs Slotted ALOHA \texttt{G} vs \texttt{S} curves}



%-------------------------------------------------------------------------------------------------
\section{Carrier Sense Multiple Access with Collision Detection\newline(CSMA/CD)}
\label{sec:csma-cd}
%-------------------------------------------------------------------------------------------------
Carrier Sense Multiple Access with Collision Detection (CSMA/CD) is a protocol for medium access in which stations can "sense" the medium and wait until it is quiet before transmitting a message (the "CS" part).
While a station is transmitting, it continues sensing the medium to detect for transmissions from other stations, which would indicate a collision (the "CD" part).
When a collision is detected, the station immediately stops, and reschedules the frame after some time.

Hence, a station would only be aware of a collision if it receives a transmission from another station while it is sending.
If a station finishes a transmission before the first bit of another station's frame arrives, then it will be unaware of the collision and falsely believe it successfully transmitted its prior frame.
For CSMA/CD to properly function, stations must be accurately aware of all collisions so that they can reschedule collided frames.

In this part of the lab, you will complete a CSMA/CD simulator that simply counts collisions: actual collisions versus station-aware collisions.
If the number of actual collisions does not match the number of station-aware collisions, then the stations will inadvertently lose data.
As you'll see, the ability of a station to detect a collision varies depending on different network characteristics and parameters.


%-------------------------------------------------------------------------------------------------
\subsection{Simulated Station Setup}
\label{subsec:station-setup}
%-------------------------------------------------------------------------------------------------
This simulation models the setup of the stations in the following ways:
\begin{itemize}
    \item Assume the stations form a star topology, so all stations are equi-distant. Thus, propagation delay is constant.
    \item Assume the stations are inter-connected by a hub (not a switch), and hence forms a single broadcast medium.
    \item The stations will pre-generate a sequence of arrival times for \textit{N} number of frames (\textit{N} is a configurable parameter). If a frame cannot be sent at a given time (i.e. due to the medium being busy), that frame is rescheduled to the end of the arrival sequence.
    \item All frames during the simulation are constant length (a configurable parameter).
\end{itemize}

%-------------------------------------------------------------------------------------------------
\subsection{Simplified CSMA/CD Protocol}
\label{subsec:simplified-csma-cd}
%-------------------------------------------------------------------------------------------------
The actual protocol you will complete is a simplified version of CSMA/CD.
The key modifications, which will make the simulation easier, are as follows:
\begin{itemize}
    \item Upon collision detection, transmission does not stop (i.e. the stations involved will finish transmitting their frames). The source station should not attempt to re-transmit this frame.
    \item When two frames collide, the frame that began transmission earlier in time "loses" (i.e. considered as 1 collision), while the frame that began transmission later in time "wins" (i.e. it can potentially be counted as a success, if and only if no subsequent frame collides with it).
    \item Upon collision, no jamming or collision enforcement is done by the stations.
    \item No inter-frame spacing (i.e. once the medium is silent, stations with a frame can send).
    \item No backoff mechanism. If a station has a frame to transmit and the medium is busy, it reschedules the frame to the end of its arrival sequence (see above section).
\end{itemize}

%-------------------------------------------------------------------------------------------------
\subsection{Logic of Simulator}
\label{subsec:logic}
%-------------------------------------------------------------------------------------------------
For each of the stations, the simulator will pre-generate the arrival times of frames to the station.
Another way to think about these arrival times is that they are the frame's transmission start times (assuming a completely free medium).
Using this information, the simulator can find the earliest frame arrival time, and compare it with the second-earliest arrival time, to see if a collision will occur.
It then "shifts forward", comparing the second-earliest with the third-earliest.
Then the third-earliest is compared against the fourth-earliest.
The simulator will repeat this pattern for each pair.
You can visualize this as a set of \textit{N} frame arrivals per station, like that shown in Fig.~\ref{arrival-seq}.

\figvs{0.6}{arrival-seq}{trim=0cm 0cm 0cm 0cm,clip}{Visualization of each station's frame arrival times.}

When analyzing the arrival times of two subsequent frames (e.g. the left-most two arrows in Fig.~\ref{arrival-seq}, from station 0 and station 2), one can determine if a collision will occur based on: 1) their arrival times; 2) the inter-station propagation delay (which is constant in this lab due to the assumed topology); and 3) the frame's serialization delay (which is constant for a given simulation run).
To determine if two subsequent frames will collide, there are three general cases to consider.


\textbf{Case 1:} Given two frame arrival times from two different stations, the latter frame arrives to find the medium free, and starts transmitting before the first bit of the former frame is able to reach the second station.
This can be visualized as seen in Fig.~\ref{collision-notaware}.

\figvs{0.6}{collision-notaware}{trim=0cm 0cm 0cm 0cm,clip}{Example of when a frame collides, and the source station is unaware of the collision.}

In this case, a collision has clearly occurred.
However, whether or not the source station for the first frame becomes aware of the collision depends on whether the first bit of the second frame is able to propagate back to the first station before the first station finishes sending its frame.
In the case of Fig.~\ref{collision-notaware}, the answer is no. Thus, the first station will falsely believe it successfully transmitted and delivered the frame.

On the other hand, if the first bit of the second frame propagates back to the first station while its still transmitting, then the first station becomes aware of the collision and properly detects it.
This is illustrated in Fig.~\ref{collision-aware}.
\figvs{0.6}{collision-aware}{trim=0cm 0cm 0cm 0cm,clip}{Example of when a frame collides, and the source station is aware of the collision.}


\textbf{Case 2:} Given two frame arrival times from two different stations, the latter frame arrives to find the medium busy, and reschedules the frame (i.e. puts it to the end of its arrival sequence).
This is illustrated in Fig.~\ref{frame-reschedule}.

\figvs{0.6}{frame-reschedule}{trim=0cm 0cm 0cm 0cm,clip}{Example of when a frame arrives while the medium is busy.}

\textbf{Case 3:} Given two frame arrival times from two different stations, the latter frame arrives to find the medium free, and starts transmitting after the final bit of the former frame reaches the second station.
This is the best case scenario and means there is no collision or rescheduling.
This case is illustrated in Fig.~\ref{no-contention}.

\figvs{0.65}{no-contention}{trim=0cm 0cm 0cm 0cm,clip}{Example of when a frame arrives with no conflict with the past frame.}


\think{Given the three scenarios illustrated, consider how the network diameter (i.e. the station-to-station distance), the frame size, and channel bandwidth can all affect the stations' ability to detect collisions.}


%-------------------------------------------------------------------------------------------------
\section{Exerciser}
\label{sec:exercise}
%-------------------------------------------------------------------------------------------------
You can use the exerciser to help test the correctness of your implementation.
The exerciser will run a set of public test cases against your code.
However, note that the tests in the exerciser is not complete and it is your responsibility to test your code to make sure it conforms to the requirement of the lab.
Ensure you have the following files all within the same directory:
\begin{itemize}
    \item \textbf{TODO}: TOOOOOOO DOOOOOOOOOOOOO
\end{itemize}

In terminal, browse to the directory containing the files and type \texttt{ece361-exercise \thelab}.

%-------------------------------------------------------------------------------------------------
\section{Submission}
\label{sec:submission}
%-------------------------------------------------------------------------------------------------
Once you are confident of your implementation, you can run the submission process (which will invoke the exerciser before submitting).
Only one person in the group needs to submit.

From the same directory as where you ran the exerciser, type \texttt{ece361-submit submit \thelab}.

You can then verify the submission by typing \texttt{ece361-submit list \thelab}.

At some point after the lab's due date, private test cases will be run against your submission to calculate your final mark.

%-------------------------------------------------------------------------------------------------
\newpage
\appendix
\section{Appendix}
\label{sec:appendix}
%-------------------------------------------------------------------------------------------------
\textbf{TODO}


\end{document}
